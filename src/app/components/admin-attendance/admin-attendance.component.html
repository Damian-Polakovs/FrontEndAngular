<div class="attendance-container">
  <app-navbar></app-navbar>

  <form [formGroup]="attendanceForm">
    <div class="form-controls">
      <mat-form-field appearance="outline">
        <mat-label>Select Class</mat-label>
        <mat-select formControlName="class_id">
          <mat-option *ngFor="let class of classSchedule" [value]="class.id">
            {{class.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="date">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <div class="action-buttons">
        <button mat-button (click)="applyFilter()">
          <mat-icon>filter_list</mat-icon> Filter
        </button>
      </div>
    </div>
  </form>

  <div class="attendance-table-container">
    <table mat-table [dataSource]="filteredStudents" class="attendance-table">
      <ng-container matColumnDef="student_id">
        <th mat-header-cell *matHeaderCellDef>Student ID</th>
        <td mat-cell *matCellDef="let student">{{student.student_id}}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let student">{{student.student_name}}</td>
      </ng-container>

      <ng-container matColumnDef="present">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let student">
          <mat-radio-group [(ngModel)]="student.status" [name]="'attendance_' + student.student_id">
            <mat-radio-button value="present">Present</mat-radio-button>
            <mat-radio-button value="late">Late</mat-radio-button>
            <mat-radio-button value="absent">Absent</mat-radio-button>
          </mat-radio-group>
        </td>
      </ng-container>

      <ng-container matColumnDef="comments">
        <th mat-header-cell *matHeaderCellDef>Comments</th>
        <td mat-cell *matCellDef="let student">
          <mat-form-field class="comment-field">
            <input matInput [(ngModel)]="student.comments" [name]="'comment_' + student.student_id" placeholder="Add comment...">
          </mat-form-field>
        </td>
      </ng-container>

      <ng-container matColumnDef="overall_attendance">
        <th mat-header-cell *matHeaderCellDef>Overall Attendance</th>
        <td mat-cell *matCellDef="let student" [ngClass]="{'low-attendance': student.overall_attendance < '80%'}">
          {{student.overall_attendance}}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <div class="form-actions">
    <button mat-raised-button color="primary" (click)="saveAttendance()">Save Attendance</button>
  </div>
</div>
